/*! d3.chart.candlestick - v0.0.1
 *  License: MIT Expat
 *  Date: 2013-06-21
 */
d3.chart("CandlestickChart",{initialize:function(t){function e(){var t=this.data().length;this.attr("class","candle").attr("x",function(t){return f.x(d(t.open_time))}).attr("y",function(t){return f.height()-f.y(s(t))}).attr("width",(f.width()-f.margin.right)/t).attr("height",function(t){return h(f.y,t)}).attr("fill",g).attr("stroke","black")}function i(){var t=this.data().length;this.attr("class","wick").attr("x1",function(e){return f.x(d(e.open_time))+(f.width()-f.margin.right)/t/2}).attr("x2",function(e){return f.x(d(e.open_time))+(f.width()-f.margin.left)/t/2}).attr("y1",function(t){return f.height()-f.y(Number(t.high))}).attr("y2",function(t){return f.height()-f.y(Number(t.low))}).attr("width",1).attr("stroke",g)}function n(){this.duration(1e3).attr("x",function(t){return f.x(d(t.open_time))-.5})}function r(){this.duration(1e3).attr("x",function(t){return f.x(d(t.open_time))-.5})}function a(){this.duration(1e3).attr("x",function(t){return f.x(d(t.open_time))-.5}).remove()}function s(t){return Math.max(Number(t.open),Number(t.close))}function h(t,e){return t(Math.max(Number(e.open),Number(e.close)))-t(Math.min(Number(e.open),Number(e.close)))}function o(t){return this.selectAll("rect.candle").data(t,function(t){return t.open_time})}function u(t){return this.selectAll("line.wick").data(t,function(t){return t.open_time})}function c(){return this.insert("rect","line")}function l(){return this.insert("line")}function d(t){return new Date(t).getTime()/1e3}function g(t){return Number(t.open)>Number(t.close)?"red":"green"}t=t||{};var f=this;this.x=d3.scale.linear(),this.y=d3.scale.linear(),this.base.attr("class","chart"),this.layer("grid-x",this.base.append("g"),{dataBind:function(){return this.selectAll("line.grid.grid-x").data(f.x.ticks(10))},insert:function(){return this.insert("line").attr("class","grid grid-x").attr("x1",f.x).attr("x2",f.x).attr("y1",0).attr("y2",f.height()).attr("stroke","#ccc")}}),this.layer("grid-y",this.base.append("g"),{dataBind:function(){return this.selectAll("line.grid.grid-y").data(f.y.ticks(10))},insert:function(){return this.insert("line").attr("class","grid grid-y").attr("x1",0).attr("x2",f.width()-f.margin.right).attr("y1",f.y).attr("y2",f.y).attr("stroke","#ccc")}}),this.layer("grid-y-labels",this.base.append("g"),{dataBind:function(){return this.selectAll("text.yLabel").data(f.y.ticks(10))},insert:function(){return this.insert("text").attr("class","yLabel").attr("x",f.width()-f.margin.right).attr("y",f.y).attr("dy",5).attr("dx",20).attr("text-anchor","left").text(function(t){return t.toFixed(1)+""})}}),this.layer("wicks",this.base.append("g").attr("class","wicks"),{dataBind:u,insert:l}),this.layer("bars",this.base.append("g").attr("class","bars"),{dataBind:o,insert:c}),this.layer("info",this.base.append("g").attr("class","info"),{}),this.layer("bars").on("enter",e),this.layer("bars").on("enter:transition",n),this.layer("bars").on("update:transition",r),this.layer("bars").on("exit:transition",a),this.layer("wicks").on("enter",i);var m=d3.bisector(function(t){return new Date(t.open_time).getTime()/1e3}).left;window.c=this,this.base.on("mouseover",function(){var t=f.x.invert(d3.mouse(this)[0]),e=f.layer("bars").selectAll("rect.candle").data(),i=m(e,t,1),n=e[i];if(n){f.layer("info").append("rect").attr("class","info").attr("width",200).attr("height",200).attr("x",0).attr("y",0).attr("fill","white");var r=20;[n.open_time,"Vol: "+n.volume,"Close: "+n.close,"Low: "+n.low,"Open: "+n.open,"High: "+n.high].forEach(function(t){f.layer("info").append("text").attr("class","info").text(t).attr("y",r),r+=20})}}),this.base.on("mouseout",function(){var t=f.base[0][0].getBBox(),e=event.x<t.x||event.x>t.x+t.width,i=event.y<t.y||event.y>t.y+t.height;(i||e)&&(f.base.selectAll("rect.info").remove(),f.base.selectAll("text.info").remove())}),this.width(t.width||600),this.height(t.height||500),this.margin={top:0,bottom:0,left:0,right:100}},width:function(t){return arguments.length?(this.w=t,this.x.range([0,this.w]),this.base.attr("width",this.w),this):this.w},height:function(t){return arguments.length?(this.h=t,this.y.rangeRound([0,this.h]),this.base.attr("height",this.h),this):this.h},transform:function(t){return t=t.data,this.x.domain([new Date("2013-06-15T00:42:00-05:00").getTime()/1e3,new Date("2013-06-15T02:42:00-05:00").getTime()/1e3]).range([0,this.width()-this.margin.right]),this.y.domain([d3.min(t.map(function(t){return Number(t.low)})),d3.max(t.map(function(t){return Number(t.high)}))]),t}});